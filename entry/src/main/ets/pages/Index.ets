import { TransactionListPage } from './TransactionListPage';

@Entry
@Component
struct Index {
  @State currentTab: string = 'details'; // 'details' | 'stats' | 'budget' | 'settings'
  @State refreshKey: number = 0; // ç”¨äºŽå¼ºåˆ¶åˆ·æ–°å­ç»„ä»¶

  onPageShow(): void {
    // ä»Žç¼–è¾‘é¡µè¿”å›žæ—¶åˆ·æ–°æ˜Žç»†é¡µé¢
    this.refreshKey++;
  }

  navigateToEdit(): void {
    const router = this.getUIContext().getRouter();
    router.pushUrl({ url: 'pages/TransactionEditPage' }).catch((err: Error) => {
      console.error('Navigate failed:', err);
    });
  }

  build() {
    Stack({ alignContent: Alignment.Bottom }) {
      // ä¸»å†…å®¹åŒºï¼ˆä½¿ç”¨Stackè®©å†…å®¹å¡«å……æ•´ä¸ªç©ºé—´ï¼‰
      Column() {
        if (this.currentTab === 'details') {
          TransactionListPage({ refreshTrigger: this.refreshKey })
        } else if (this.currentTab === 'stats') {
          Column() {
            Text('ç»Ÿè®¡ï¼ˆç©ºï¼‰')
              .fontSize(18)
              .fontColor('#666666')
          }
          .width('100%')
          .height('100%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .backgroundColor('#f5f5f5')
        } else if (this.currentTab === 'budget') {
          Column() {
            Text('é¢„ç®—ï¼ˆç©ºï¼‰')
              .fontSize(18)
              .fontColor('#666666')
          }
          .width('100%')
          .height('100%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .backgroundColor('#f5f5f5')
        } else if (this.currentTab === 'settings') {
          Column() {
            Text('è®¾ç½®ï¼ˆç©ºï¼‰')
              .fontSize(18)
              .fontColor('#666666')
          }
          .width('100%')
          .height('100%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .backgroundColor('#f5f5f5')
        }
      }
      .width('100%')
      .height('100%')
      .padding({ bottom: 64 })

      // åº•éƒ¨å¯¼èˆªåŒºåŸŸï¼ˆå›ºå®šåœ¨åº•éƒ¨ï¼‰
      Column() {
        Row() {
          // æ˜Žç»†
          Column() {
            Text('ðŸ“Š')
              .fontSize(20)
              .margin({ bottom: 4 })
            Text('æ˜Žç»†')
              .fontSize(12)
              .fontColor(this.currentTab === 'details' ? '#4CAF50' : '#999999')
          }
          .width('20%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .padding({ top: 8, bottom: 8 })
          .onClick(() => { this.currentTab = 'details'; })

          // ç»Ÿè®¡
          Column() {
            Text('ðŸ“ˆ')
              .fontSize(20)
              .margin({ bottom: 4 })
            Text('ç»Ÿè®¡')
              .fontSize(12)
              .fontColor(this.currentTab === 'stats' ? '#4CAF50' : '#999999')
          }
          .width('20%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .padding({ top: 8, bottom: 8 })
          .onClick(() => { this.currentTab = 'stats'; })

          // ä¸­é—´å¿«æ·è®°è´¦å ä½ï¼ˆç©ºåˆ—ï¼Œç”¨äºŽå±…ä¸­æ‚¬æµ®æŒ‰é’®ï¼‰
          Column() {
            Text('')
              .fontSize(12)
          }
          .width('20%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)

          // é¢„ç®—
          Column() {
            Text('ðŸ’°')
              .fontSize(20)
              .margin({ bottom: 4 })
            Text('é¢„ç®—')
              .fontSize(12)
              .fontColor(this.currentTab === 'budget' ? '#4CAF50' : '#999999')
          }
          .width('20%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .padding({ top: 8, bottom: 8 })
          .onClick(() => { this.currentTab = 'budget'; })

          // è®¾ç½®
          Column() {
            Text('âš™ï¸')
              .fontSize(20)
              .margin({ bottom: 4 })
            Text('è®¾ç½®')
              .fontSize(12)
              .fontColor(this.currentTab === 'settings' ? '#4CAF50' : '#999999')
          }
          .width('20%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .padding({ top: 8, bottom: 8 })
          .onClick(() => { this.currentTab = 'settings'; })
        }
        .width('100%')
        .height(64)
        .backgroundColor('#ffffff')
        .borderWidth({ top: 1 })
        .borderColor('#f0f0f0')
        .shadow({ radius: 4, color: '#00000010', offsetY: -2 })

        // åº•éƒ¨ä¸­å¤®å¿«æ·è®°è´¦æ‚¬æµ®æŒ‰é’®
        Button() {
          Text('+')
            .fontSize(32)
            .fontColor('#ffffff')
            .fontWeight(FontWeight.Bold)
        }
        .width(64)
        .height(64)
        .borderRadius(32)
        .backgroundColor('#4CAF50')
        .shadow({ radius: 8, color: '#00000020', offsetY: 2 })
        .position({ x: '50%', y: 20 })
        .translate({ x: '-50%', y: '-50%' })
        .onClick(() => this.navigateToEdit())
      }
      .width('100%')
    }
    .width('100%')
    .height('100%')
  }
}